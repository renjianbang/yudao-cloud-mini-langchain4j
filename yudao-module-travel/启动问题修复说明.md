# å·®æ—…ç³»ç»Ÿå¯åŠ¨é—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜ç—‡çŠ¶
```
org.springframework.beans.factory.BeanCreationNotAllowedException: Error creating bean with name 'taskScheduler'
A component required a bean of type 'java.util.List' that could not be found.
Parameter 2 of method apiAccessLogFilter in YudaoApiLogAutoConfiguration required a bean of type 'FeignClientFactory' that could not be found.
Parameter 2 of method apiAccessLogFilter required a single bean, but 2 were found: feignClientFactory and feignContext
Unable to start embedded Tomcat
No Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-loadbalancer?
```

## é—®é¢˜åŸå› åˆ†æ
1. **å¾®æœåŠ¡å•ä½“å¯åŠ¨é…ç½®ä¸å®Œæ•´**ï¼šç¼ºå°‘å¿…è¦çš„åŒ…æ‰«æå’ŒBeané…ç½®
2. **Spring Cloudç»„ä»¶å¹²æ‰°**ï¼šNacosã€Feignç­‰å¾®æœåŠ¡ç»„ä»¶åœ¨å•ä½“å¯åŠ¨æ—¶é€ æˆå†²çª
3. **å¤–éƒ¨ä¾èµ–è¿‡å¤š**ï¼šElasticsearchã€RabbitMQç­‰å¤–éƒ¨æœåŠ¡ä¾èµ–å¯¼è‡´å¯åŠ¨å¤±è´¥
4. **Beanç”Ÿå‘½å‘¨æœŸç®¡ç†é—®é¢˜**ï¼šåœ¨Beané”€æ¯è¿‡ç¨‹ä¸­å°è¯•åˆ›å»ºæ–°Beanå¯¼è‡´å¼‚å¸¸
5. **FeignClientFactoryä¾èµ–ç¼ºå¤±**ï¼šèŠ‹é“æ¡†æ¶çš„APIæ—¥å¿—ç»„ä»¶ä¾èµ–äºFeignï¼Œä½†Feignè¢«ç¦ç”¨
6. **Beanå†²çªé—®é¢˜**ï¼šæ‰‹åŠ¨é…ç½®çš„FeignClientFactoryä¸OpenFeignè‡ªåŠ¨é…ç½®çš„Beanå†²çª
7. **LoadBalancerä¾èµ–ç¼ºå¤±**ï¼šFeignå®¢æˆ·ç«¯éœ€è¦LoadBalancerè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä½†è¢«ç¦ç”¨
8. **Tomcatå¯åŠ¨å¤±è´¥**ï¼šç”±äºBeanåˆ›å»ºå¤±è´¥å¯¼è‡´WebæœåŠ¡å™¨æ— æ³•å¯åŠ¨

## ä¿®å¤æªæ–½

### 1. å¯åŠ¨ç±»é…ç½®ä¼˜åŒ–
**æ–‡ä»¶**: `TravelServerApplication.java`
```java
@SpringBootApplication(scanBasePackages = {"cn.iocoder.yudao.framework", "cn.iocoder.yudao.module.travel"})
public class TravelServerApplication {
    // æ·»åŠ äº†æ­£ç¡®çš„åŒ…æ‰«æé…ç½®ï¼Œç¡®ä¿æ¡†æ¶ç»„ä»¶èƒ½è¢«æ­£ç¡®åŠ è½½
}
```

### 2. è‡ªåŠ¨é…ç½®æ’é™¤ä¼˜åŒ–
**æ–‡ä»¶**: `application.yaml`
```yaml
spring:
  autoconfigure:
    exclude:
      - com.alibaba.cloud.nacos.discovery.NacosDiscoveryAutoConfiguration
      - com.alibaba.cloud.nacos.NacosConfigAutoConfiguration
      - org.springframework.cloud.loadbalancer.config.LoadBalancerAutoConfiguration
      # ç§»é™¤äº†FeignAutoConfigurationçš„æ’é™¤ï¼Œå…è®¸Feignæ­£å¸¸åŠ è½½
```
**ä½œç”¨**: ç¦ç”¨å¾®æœåŠ¡ç›¸å…³çš„è‡ªåŠ¨é…ç½®ï¼Œä½†ä¿ç•™Feignæ”¯æŒ

### 3. æœ¬åœ°é…ç½®ä¼˜åŒ–
**æ–‡ä»¶**: `application-local.yaml`
```yaml
spring:
  cloud:
    nacos:
      discovery:
        enabled: false
      config:
        enabled: false
    loadbalancer:
      enabled: false
    openfeign:
      enabled: true  # å…è®¸Feignè‡ªåŠ¨é…ç½®
      discovery:
        enabled: false  # ç¦ç”¨Feignçš„æœåŠ¡å‘ç°
    gateway:
      enabled: false
```
**ä½œç”¨**: å…è®¸Feignè‡ªåŠ¨é…ç½®ä½†ç¦ç”¨æœåŠ¡å‘ç°åŠŸèƒ½

### 4. å¤–éƒ¨æœåŠ¡ç¦ç”¨
**æ–‡ä»¶**: `application-travel.yaml`
```yaml
# ç¦ç”¨Elasticsearch
yudao:
  elasticsearch:
    enabled: false

spring:
  elasticsearch:
    enabled: false
  
# ç¦ç”¨RabbitMQ  
  rabbitmq:
    enabled: false

# ç¦ç”¨å®šæ—¶ä»»åŠ¡
xxl:
  job:
    enabled: false
```
**ä½œç”¨**: åœ¨å¼€å‘ç¯å¢ƒä¸­ç¦ç”¨å¤–éƒ¨æœåŠ¡ä¾èµ–ï¼Œé¿å…è¿æ¥å¤±è´¥

### 7. **LoadBalancerä¾èµ–æ·»åŠ **
**æ–‡ä»¶**: `pom.xml`
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>
```
**æ–‡ä»¶**: `application.yaml` ç§»é™¤LoadBalancerè‡ªåŠ¨é…ç½®æ’é™¤
```yaml
spring:
  autoconfigure:
    exclude:
      - com.alibaba.cloud.nacos.discovery.NacosDiscoveryAutoConfiguration
      - com.alibaba.cloud.nacos.NacosConfigAutoConfiguration
      # ç§»é™¤äº†LoadBalancerçš„æ’é™¤ï¼Œå› ä¸ºFeignéœ€è¦å®ƒ
```
**ä½œç”¨**: è§£å†³Feignå®¢æˆ·ç«¯å¯¹LoadBalancerçš„ä¾èµ–éœ€æ±‚

### 8. **APIè®¿é—®æ—¥å¿—ç¦ç”¨**
**æ–‡ä»¶**: `application-local.yaml`
```yaml
yudao:
  access-log:
    enabled: false  # å•ä½“å¯åŠ¨æ—¶ç¦ç”¨APIè®¿é—®æ—¥å¿—
```
**ä½œç”¨**: é¿å…åœ¨å•ä½“å¯åŠ¨æ—¶ä¾èµ–å¾®æœåŠ¡APIæ—¥å¿—ç»„ä»¶

## ä¿®å¤æ•ˆæœ

### âœ… è§£å†³çš„é—®é¢˜
1. **BeanCreationNotAllowedException**: é€šè¿‡æ­£ç¡®çš„åŒ…æ‰«æå’Œé…ç½®æ’é™¤è§£å†³
2. **List Beanä¾èµ–é—®é¢˜**: é€šè¿‡ç¦ç”¨ä¸å¿…è¦çš„è‡ªåŠ¨é…ç½®è§£å†³
3. **taskScheduleråˆ›å»ºå¼‚å¸¸**: é€šè¿‡ä¼˜åŒ–Beanç”Ÿå‘½å‘¨æœŸç®¡ç†è§£å†³
4. **å¾®æœåŠ¡ç»„ä»¶å†²çª**: é€šè¿‡æ˜ç¡®ç¦ç”¨ç›¸å…³ç»„ä»¶è§£å†³
5. **FeignClientFactoryä¾èµ–ç¼ºå¤±**: é€šè¿‡æ¡ä»¶é…ç½®å’Œå…è®¸Feignè‡ªåŠ¨é…ç½®è§£å†³
6. **FeignClientFactory Beanå†²çª**: é€šè¿‡åˆ é™¤æ‰‹åŠ¨é…ç½®ï¼Œä½¿ç”¨OpenFeignè‡ªåŠ¨é…ç½®è§£å†³
7. **LoadBalancerä¾èµ–ç¼ºå¤±**: é€šè¿‡æ·»åŠ ä¾èµ–å’Œç§»é™¤è‡ªåŠ¨é…ç½®æ’é™¤è§£å†³
8. **Tomcatå¯åŠ¨å¤±è´¥**: é€šè¿‡è§£å†³æ‰€æœ‰Beanä¾èµ–é—®é¢˜ä½¿WebæœåŠ¡å™¨æ­£å¸¸å¯åŠ¨

### ğŸ“‹ é…ç½®åŸåˆ™
1. **æœ€å°åŒ–ä¾èµ–**: åªå¯ç”¨å¿…è¦çš„ç»„ä»¶ï¼Œç¦ç”¨å¤–éƒ¨æœåŠ¡
2. **åŒ…æ‰«æä¼˜åŒ–**: ç¡®ä¿æ¡†æ¶ç»„ä»¶è¢«æ­£ç¡®æ‰«æ
3. **é…ç½®éš”ç¦»**: å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒé…ç½®åˆ†ç¦»
4. **æ¡ä»¶ä¾èµ–**: ä½¿ç”¨æ¡ä»¶é…ç½®æ§åˆ¶ç»„ä»¶åŠ è½½

### ğŸš€ å¯åŠ¨éªŒè¯
è¿è¡Œæµ‹è¯•ç±» `StartupConfigurationTest` éªŒè¯ä¿®å¤æ•ˆæœï¼š
- Spring Bootä¸Šä¸‹æ–‡æ­£å¸¸åŠ è½½
- æ‰€æœ‰Beanä¾èµ–é—®é¢˜è§£å†³
- åº”ç”¨å¯ä»¥åœ¨å•æœºç¯å¢ƒä¸‹æ­£å¸¸å¯åŠ¨

## ç”Ÿäº§ç¯å¢ƒå¯ç”¨
å½“éœ€è¦å¯ç”¨å®Œæ•´åŠŸèƒ½æ—¶ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
```yaml
# å¯ç”¨Elasticsearch
yudao:
  elasticsearch:
    enabled: true

# å¯ç”¨RabbitMQ
spring:
  rabbitmq:
    enabled: true

# å¯ç”¨å®šæ—¶ä»»åŠ¡
xxl:
  job:
    enabled: true
```

## æŠ€æœ¯è§„èŒƒéµå¾ª
- âœ… Spring Bootå¯åŠ¨ç±»è§„èŒƒï¼š`{Module}Application`å‘½å
- âœ… å•ä½“å¯åŠ¨é…ç½®è§„èŒƒï¼šç¦ç”¨Nacosæ³¨å†Œå‘ç°
- âœ… æ¡ä»¶ä¾èµ–æ³¨å…¥è§„èŒƒï¼šå¤–éƒ¨æœåŠ¡å¯é€‰ä¾èµ–
- âœ… å¼‚å¸¸å¤„ç†ç»éªŒï¼šBeanCreationNotAllowedExceptionè§£å†³æ–¹æ¡ˆ